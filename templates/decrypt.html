{% extends "base.html" %}

{% block content %}
<h1 class="main-heading">Cerpent Cipher</h1>
<h2 class="section-heading">Decryption Tool</h2>

<div class="alert alert-info">
    <strong>Decrypt with Cerpent Cipher:</strong>
    <ul>
        <li>Paste your ciphertext (in hexadecimal format, comma-separated) into the field below.</li>
        <li>Enter the secret key (in hexadecimal format) used for encryption.</li>
        <li>If the key was recently generated on this site, it might auto-populate.</li>
        <li>Click “Decrypt Message” to recover your original plaintext.</li>
    </ul>
</div>

<div class="heading-container">
    <h3>Cerpent Cipher Decryption</h3>
</div>

<form method="POST" action="{{ url_for('decrypt_page') }}"> {# Use url_for for the action #}
    <div class="form-group">
        <label for="ciphertext">Enter Ciphertext:</label>
        <textarea class="form-control" id="ciphertext" name="ciphertext" rows="5" required placeholder="Paste your comma-separated hexadecimal ciphertext here..."></textarea>
    </div>
    <div class="form-group">
        <label for="key">Secret Key (in hex):</label>
        <input type="text" class="form-control" id="key" name="key" required placeholder="Enter the 64-character hexadecimal key...">
    </div>
    <button type="submit" class="btn btn-primary">Decrypt Message</button>
</form>

<br>
<a href="{{ url_for('encrypt_page') }}" class="btn btn-secondary">Back to Encrypt</a> {# Link back to the encrypt page using url_for #}

{% endblock %}

{% block scripts %}
<script>
window.onload = function() {
    // Attempt to retrieve the key from session storage and populate the field
    var key = sessionStorage.getItem("secret_key");
    var keyInput = document.getElementById("key");
    if(key && !keyInput.value){ // Only pre-fill if session key exists and field is empty
        keyInput.value = key;
    }
};
</script>
{% endblock %}